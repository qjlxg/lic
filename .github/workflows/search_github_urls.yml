name: æœç´¢å¹¶æ›´æ–° IPTV URL

on:
  push:
    paths:
      - 'search_github_urls.py'
      - '.github/workflows/search_github_urls.yml'
      - 'config/urls.txt'
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

env:
  TZ: Asia/Shanghai 
  
jobs:
  search_and_update:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ğŸ“¦ Checkout repository (v4)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ Set up Python (v5)
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: âš™ï¸ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pyyaml aiohttp tqdm

      - name: ğŸ“‚ Create config directory
        run: |
          mkdir -p config
          
      - name: ğŸƒ Run search script
        id: run_script
        env:
          BOT: ${{ secrets.BOT }}
        run: |
          python search_github_urls.py
      
      # *** ä¿®å¤æ­¥éª¤ï¼šæ·»åŠ  push_options: --force ***
      - name: ğŸ’¾ Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: config/urls.txt
          commit_message: "âœ¨ feat: Auto discovered new .m3u8 IPTV URLs"
          branch: ${{ github.ref_name }}
          skip_dirty_check: false
          # ã€æ–°å¢ã€‘å¼ºåˆ¶æ¨é€ï¼Œè§£å†³éå¿«è¿›å¼æ¨é€è¢«æ‹’ç»çš„é”™è¯¯
          push_options: --force
